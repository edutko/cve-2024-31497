server: cmd/server internal/*
	[ -d out ] || mkdir out
	go build -o out/server ./cmd/server/...

clean:
	rm -rf out

server-all: cmd/server internal/*
	[ -d out ] || mkdir out
	GOOS=linux GOARCH=amd64 go build -o out/server-linux-amd64 ./cmd/server/...
	GOOS=linux GOARCH=arm64 go build -o out/server-linux-arm64 ./cmd/server/...

docker-images: server-all
	cp out/server-linux-amd64 out/server-linux
	docker build --platform linux/amd64 -t cve-2024-31497-amd64 .
	cp out/server-linux-arm64 out/server-linux
	docker build --platform linux/arm64 -t cve-2024-31497-arm64 .
	rm out/server-linux
